---
title: "TRABAJO FINAL RSTUDIO"
author: LUIS CAMPO RIOS
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
   theme: cayman  
   highlight: github
   math: katex

---
```{r setup, include=FALSE}
##knitr::opts_chunk$set(echo = TRUE)
library(xml2)
library(rvest)
library(lubridate)
library(dplyr)
library(ggplot2)
library(stringr)
library(tidyr)
library(scales)
library(plotly)
library(knitr)
library(prettydoc)

# Lectura de la tabla usando Scraping y limpieza de datos
url.expor <- "https://datosmacro.expansion.com/comercio/exportaciones?anio=2018"
datos <- read_html(url.expor)
datos <- html_nodes(datos,"table")
length(datos)
sapply(datos, class)
sapply(datos, function(x) dim(html_table(x, fill = TRUE)))
datos <- html_table(datos[[1]],header = T)
datos <- data.frame(datos,stringsAsFactors = FALSE)
datos$Exportaciones.1 <- NULL
datos
names(datos) <- c("Paises","Fecha","Export(€)","PIB(%)","VAR")
datos$Paises <- gsub("\\[\\+\\]", "",datos$Paises)
datos$`Export(€)` <- gsub("M.€","",datos$`Export(€)`)
datos$Fecha <- as.numeric(datos$Fecha)
datos$`Export(€)` <- gsub("\\.","",datos$`Export(€)`)
datos$`Export(€)` <- gsub(",","\\.",datos$`Export(€)`)
datos$`Export(€)`<- as.numeric(datos$`Export(€)`)
datos$`PIB(%)` <- gsub("%","",datos$`PIB(%)`)
datos$`PIB(%)` <- gsub(",",".",datos$`PIB(%)`)
datos$`PIB(%)` <- as.numeric(datos$`PIB(%)`)
datos$VAR <- gsub(",",".",datos$VAR)
datos$VAR <- as.numeric(datos$VAR)
str(datos)
#Extrayengo el Top 10 de paises

datos <- datos[order(-datos$`Export(€)`),]
datosend <- head(datos, n=10)
datosend

```

<center><h1>**INTRODUCCIÓN**</h1></center>

<p align="justify">**EN EL DESARROLLO DE ESTE DOCUMENTO REALIZAREMOS COMENTARIO SOBRE ALGUNAS PAGINAS WEB QUE SE ENFOCAN A EXPRESIONES REGULARES Y A RMARKDOWN, A SU VEZ SE REALIZARA CONSTRUCCION DE GRAFICO DESDE LA EXTRACCION DE DATA DE INFORMACION MEDIANTE WEBSCRAPING, EL TEMA USADO ES PAISES CON MEJOR EXPORTACION HASTA LA FECHA.**</p>

<h4><center>**1.EXPRESIONES REGULARES**</center></h4>

<span style="color:black">Para esta seccion he revisado y analizado dos paginas wen relacionados a expresiones regulares, los autores son : <span style="color:blue">[**Diego Calvo**](<http://www.diegocalvo.es/expresiones-regulares-en-r/>),<span style="color:blue">[**Kenneth Cabrera**](https://labscn-unalmed.github.io/modulo-R/slides/11_Expresiones_Regulares.html#/) 

<p>Diego nos brinda variedad de expresiones regulares comunes y con sus propias sintaxys, concepto, asu vez nos brinda ejemplos de cada uno de ellos facil y sensillo de entenderlo, a comparación con la web de Kenneth si bien es cierto tiene buenos ejemplos pero no tiene la misma cantidad de expresiones regulares que Diego Calvo.</p>

<p>Por otro lado, kanneth en cuanto a comparaciòn de una expresion regular **gsub**, tiene mas ejemplos y claros con respecto a Diego calvo, por lo tanto yo me quedaria con Diego calvo en cuanto a su variedad y ejemmlos de expresiones, sin embargo a kanneth lo tendria en cuenta para cualquier duda que se presente en una la expresion gsub.</p>

En la siguiente tabla, mostrare algunas de las expresiones con sus respectiva descripción,para Rstudio.

| EXPRESION | DESCRIPCION                                                                                   | 
| :-------  | :--------------------------------------------------------------------------------------------:| 
| Substring | Seleccionar un substring                                                                      |
| GREP      | Encuentra patrones de la expresión regular en la cadena                                       |
| GREPL     | Determina si una sub-cadena pertenece a una cadena                                            |
| GSUB      | Sustituye en una cadena los elementos que cumplan la expresión regular por otro que se indique|


<h4><center>**2. RECURSO RMARKDOWN**</center></h4>
 
Para esta sección hablaremos de:<span style="color:blue">[**Javier Cristóbal**](<https://markdown.es/sintaxis-markdown/>),<span style="color:blue">[**Tomas Goicoa**](<http://www.unavarra.es/personal/tgoicoa/ESTADISTICA_RMarkdown_tomas/basicRmarkdown/index.html#143_formatos_de_texto>):

<span style="color:Green">**Javier Cristóbal**</span> hizo un web que inicia desde el **Que** es rmarkdown, la **Sintaxis**", **editores** de markdown y **multimarkdown**, en el cual dentro de ello tiene un indice de sintaxis en donde explica muy bien cada punto tales como: Parrafos, Emcabezados, Citas,Listas...etc.

En cambio <span style="color:Green">**Tomas Goicoa**</span>, nos brinda una guida sensilla pero a la vez util mostrando los tipos de archivo que se ejecutan, explica el cuerpo del documento, los formato de texto y un ejemplo.

Dicho a todo esto, yo me quedaria con la web de Javier ya que esta mejor explicada y tiene mas campo de aprendizaje referente a rmarkdown.


<h3>**3.TABLA DE CONTENIDO SOBRE Nº DE EX**</h3>

Las exportaciones son las ventas de bienes que un país realiza al resto. Las exportaciones suman dentro de la balanza comercial, cuando son mayores que las importaciones la balanza comercial es positiva, o lo que es lo mismo, hay superávit de balanza comercial.

Las exportaciones son importantes porque constituyen una fuente de divisas que a su vez permiten hacer frente a la deuda y a las importaciones y que incrementan los ingresos per cápita. El hecho de que se produzcan bienes para su exportación, incrementa la producción de estos y esto tiene un efecto positivo sobre el empleo.
```{r tabladatos, echo=FALSE}
kable(datosend, format = "markdown" ,caption = "Una kable knitr",digits = 3
 , col.names = c("Paises","Fecha","Export(€)","PIB(%)","VAR"), row.names = TRUE)
```

## GRAFICOS GGPLOT

**A continuacion, se muestra dos graficos en donde observaremos:**

**A.Grafico 1 : Nos muestra el top 10 de los paises con mayor exportacion y su varianza en % con respecto al año anterior, el cual se mostrara cuando pasemos el curso en una de las barras, a la ves esta resaltado de color rojo el pais con mayor cantidad en exportacion (euros).**

```{r pressure, echo=FALSE}
# GRAFICO DONDE SE RESALTA EL PAISES QUE MAYOR EXPORTACION HA TENIDO Y SU VARIACION EN %


VAR <- datosend$VAR
grafico1 <- plot_ly(datosend, x = ~Paises, y = ~`Export(€)`, type = "bar", text =VAR,
        marker = list(color = c('rgba(270,45,38,2)', 'rgba(204,204,204,1)',
                                'rgba(204,204,204,1)', 'rgba(204,204,204,1)',
                                'rgba(204,204,204,1)', 'rgba(204,204,204,1)',
                                'rgba(204,204,204,1)', 'rgba(204,204,204,1)',
                                'rgba(204,204,204,1)','rgba(204,204,204,1)')),
name = "Paises")%>% layout(title = "TOP 10 PAISES CON MAS EXPORTACION Y VARIANZA")

grafico1

```

**B.Grafico 2 : Nos muestra  el top 10 de los paises con respecto a su producto interno bruto (PIB %).**

```{r grafico2, echo=FALSE}

# Realizando grafico de barras usando GGplot2, comparando paises vs Mayor PIB

grafico2 <- datosend %>%
  arrange(desc(datosend$`PIB(%)`)) %>%
  mutate(Paises = factor(Paises , level =  Paises)) %>%
  ggplot(aes(Paises, `PIB(%)`)) + 
  geom_bar(stat = "identity",
           fill = "light blue",
           color ="black"
           ) + 
  geom_text(aes(label = comma((`PIB(%)`))),
              vjust= - 0.3) +
  labs(x = "Paises", y= "Exportaciones en PIB %",
        title= "PAISES CON MAS EXPORTACION EN BASE A SU PIB (%)") +
  scale_y_continuous(labels = comma) +
 theme_minimal()
  #coord_flip()
grafico2 
```
